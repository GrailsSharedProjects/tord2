{"changed":true,"filter":false,"title":"UploaderController.groovy","tooltip":"/grails-app/controllers/uploader/UploaderController.groovy","value":"package uploader\nimport com.tord.Photo;\n\nimport grails.converters.JSON\n\nclass ImagebedController {\n\n\tdef upload() {\n\t\tprintln \"inside controller: \" + params\n\t\tif(params.file){\n\t\t\t\tdef f = request.getFile('file');\n\t\t\t\t\tprintln f.size;\n\t\t\t\t\tif(!f.empty) {\n\t\t\t\t\t\tdef webRootDir = servletContext.getRealPath(\"/\")\n\t\t\t\t\t\tprintln webRootDir\n\t\t\t\t\t\tdef date = new Date().getCalendarDate();\n\t\t\t\t\t\tdef path = \"/uploaded/${date.getYear()}/${date.getMonth()}/${date.getDayOfMonth()}/\"\n\t\t\t\t\t\t\n\t\t\t\t\t\tprintln \"userDIR: \" + path\n\t\t\t\t\t\t\n\t\t\t\t\t\tdef userDir = new File(webRootDir, path)\n\t\t\t\t\t\tuserDir.mkdirs();\n\t\t\t\t\t\t\n\t\t\t\t\t\tdef String fName = f.originalFilename;\n\t\t\t\t\t\tfName = fName.replaceAll(\"[\\\\\\\\/:\\\\*\\\\?\\\"\\\\<\\\\>\\\\| ]\", \"_\")\n\t\t\t\t\t\t\n\t\t\t\t\t\tprintln \"fileName:\" + fName;\n\t\t\t\t\t\t\n\t\t\t\t\t\tdef localFile = new File( userDir, fName);\n\t\t\t\t\t\tf.transferTo(localFile)\n\t\t\t\t\t\tdef photo = Photo.createPhoto(path+fName, f.originalFilename);\n\t\t\t\t\t\tdef msg = new Msg(success:true, msg: photo.url+\"?id=\"+photo.id, file_path: photo.url);\n\t\t\t\t\t\trender msg as JSON\n\t\t\t\t\t\treturn;\n\t\t\t\t  }\n\t\t\t\t  render new Msg(success:false, msg:\"file is empty.\") as JSON\n\t\t\t\t  return;\n\t\t}\n\t\trender new Msg(success:false, msg:\"no file uploaded.\") as JSON\n\t}\n\t\n\tdef widget() {\n\t\trender view: 'widget'\n\t}\n\t\n\tdef photo() {\n\t\tdef id = params.id;\n\t\tdef fieldName = params['fieldName'];\n\t\tdef sequence = params['sequence'];\n\t\tdef editable = false;\n\t\tif(params['editable'] == \"true\" || params['editable'] == true){\n\t\t\teditable = true;\n\t\t}\n\t\tdef photo = com.tord.Photo.findById(id);\n\t\t\n\t\trender template:'/templates/imagebed/photo', model:[\n\t\t\tphoto: photo,\n\t\t\tfieldName: fieldName,\n\t\t\tsequence: sequence\n\t\t\t]\n\t}\n}\n","undoManager":{"mark":-2,"position":21,"stack":[[{"start":{"row":45,"column":0},"end":{"row":46,"column":0},"action":"remove","lines":["\tdef test() {}",""],"id":2}],[{"start":{"row":45,"column":0},"end":{"row":46,"column":0},"action":"remove","lines":["\t",""],"id":3}],[{"start":{"row":45,"column":0},"end":{"row":51,"column":0},"action":"remove","lines":["    def success(){","\t\tprintln \"inside controller: \" + params","    \tdef url = params.id + \".\" + params.format;","    \tprintln url","    \trender view:'success', model:['imageUrl': url]","    }",""],"id":4}],[{"start":{"row":45,"column":0},"end":{"row":46,"column":0},"action":"remove","lines":["\t",""],"id":5}],[{"start":{"row":7,"column":0},"end":{"row":10,"column":0},"action":"remove","lines":["    def index() {","    \tprintln \"inside controller: \" + params       ","    }",""],"id":7}],[{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"remove","lines":["    ",""],"id":8}],[{"start":{"row":5,"column":6},"end":{"row":5,"column":14},"action":"remove","lines":["Uploader"],"id":9},{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"insert","lines":["I"]}],[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"insert","lines":["M"],"id":10}],[{"start":{"row":5,"column":8},"end":{"row":5,"column":9},"action":"insert","lines":["a"],"id":11}],[{"start":{"row":5,"column":9},"end":{"row":5,"column":10},"action":"insert","lines":["g"],"id":12}],[{"start":{"row":5,"column":10},"end":{"row":5,"column":11},"action":"insert","lines":["e"],"id":13}],[{"start":{"row":5,"column":10},"end":{"row":5,"column":11},"action":"remove","lines":["e"],"id":14}],[{"start":{"row":5,"column":9},"end":{"row":5,"column":10},"action":"remove","lines":["g"],"id":15}],[{"start":{"row":5,"column":8},"end":{"row":5,"column":9},"action":"remove","lines":["a"],"id":16}],[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"remove","lines":["M"],"id":17}],[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"insert","lines":["m"],"id":18}],[{"start":{"row":5,"column":8},"end":{"row":5,"column":9},"action":"insert","lines":["a"],"id":19}],[{"start":{"row":5,"column":9},"end":{"row":5,"column":10},"action":"insert","lines":["g"],"id":20}],[{"start":{"row":5,"column":10},"end":{"row":5,"column":11},"action":"insert","lines":["e"],"id":21}],[{"start":{"row":5,"column":11},"end":{"row":5,"column":12},"action":"insert","lines":["b"],"id":22}],[{"start":{"row":5,"column":12},"end":{"row":5,"column":13},"action":"insert","lines":["e"],"id":23}],[{"start":{"row":5,"column":13},"end":{"row":5,"column":14},"action":"insert","lines":["d"],"id":24}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":5,"column":14},"end":{"row":5,"column":14},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1442353198300}